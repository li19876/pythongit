# coding=utf-8
import csv
import time
import requests
import json
from getip import getip
import pymysql
from get_cookies import get_cookie
ci ='20'
city='广州'
db = pymysql.connect(host="127.0.0.1",port = 3306,user="root",password="li123456..",db="lys",charset="utf8")
cursor=db.cursor()
# 区域店铺id ct_Poi cateName抓取，传入参数为区域id
def crow_id(id,cookie,uuid,ua,lineid):

    id_list = []
    url = 'https://meishi.meituan.com/i/api/channel/deal/list'
    head = {'Host': 'meishi.meituan.com',
            'Accept': 'application/json',
            'Accept-Encoding': 'gzip, deflate, br',
            'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
            'Referer': 'http://meishi.meituan.com/i/?ci='+ci+'&stid_b=1&cevent=imt%2Fhomepage%2Fcategory1%2F1',
            'User-Agent': ua,
            'Cookie' :cookie
            }
    p = {'http': 'http://'+getip()}
    data = {"uuid": uuid, "version": "8.3.3", "platform": 3, "app": "",
            "partner": 126, "riskLevel": 1, "optimusCode": 10,
            "originUrl": "http://meishi.meituan.com/i/?ci="+ci+"&stid_b=1&cevent=imt%2Fhomepage%2Fcategory1%2F1",
            "offset": 0, "limit": 15, "cateId": 1, "lineId": lineid, "stationId": id, "areaId": 0, "sort": "default",
            "deal_attr_23": "", "deal_attr_24": "", "deal_attr_25": "", "poi_attr_20043": "", "poi_attr_20033": ""}
    r = requests.post(url, headers=head, data=data, proxies=p)
    print(r.text)
    result = json.loads(r.text)
    if "data" not in result:
        return False
    totalcount = result['data']['poiList']['totalCount']  # 获取该分区店铺总数，计算出要翻的页数
    datas = result['data']['poiList']['poiInfos']
    print(len(datas), totalcount)
    for d in datas:
        d_list = ['', '', '', '', '', '']
        d_list[0] = d['name']
        d_list[1] = d['cateName']
        d_list[2] = d['poiid']
        d_list[3] = d['ctPoi']
        d_list[4] = d['areaName']
        d_list[5] = city
        id_list.append(d_list)
    # print(id_list)
    # 将数据保存到本地csv
    # with open('mt_id.csv', 'a', newline='', encoding='gb18030')as f:
    # 	write = csv.writer(f)
    try:
        for i in id_list:
            # write.writerow(i)
            save(i)
        db.commit()
    except Exception as e:
        print("写入发生了异常:",e)
        db.rollback()
    # 开始爬取第2页到最后一页
    offset = 0
    if totalcount > 15:
        totalcount -= 15
        while offset < totalcount:
            id_list = []
            offset += 15
            m = offset / 15 + 1
            print('Page:%d' % m)
            # 构造post请求参数，通过改变offset实现翻页
            data2 = {"uuid": uuid, "version": "8.3.3", "platform": 3, "app": "",
                     "partner": 126, "riskLevel": 1, "optimusCode": 10,
                     "originUrl": "http://meishi.meituan.com/i/?ci="+ci+"&stid_b=1&cevent=imt%2Fhomepage%2Fcategory1%2F1",
                     "offset": offset, "limit": 15, "cateId": 1, "lineId": lineid, "stationId": id, "areaId": 0,
                     "sort": "default",
                     "deal_attr_23": "", "deal_attr_24": "", "deal_attr_25": "", "poi_attr_20043": "",
                     "poi_attr_20033": ""}
            try:
                r = requests.post(url, headers=head, data=data2, proxies=p)
                print(r.text)
                result = json.loads(r.text)
                if "data" not in result:
                    getip(1)
                    return False
                datas = result['data']['poiList']['poiInfos']
                print(len(datas))
                for d in datas:
                    d_list = ['', '', '', '','','']
                    d_list[0] = d['name']
                    d_list[1] = d['cateName']
                    d_list[2] = d['poiid']
                    d_list[3] = d['ctPoi']
                    d_list[4] = d['areaName']
                    d_list[5] = city
                    id_list.append(d_list)
                # 保存到本地
                # with open('mt_id.csv', 'a', newline='', encoding='gb18030')as f:
                # 	write = csv.writer(f)
                # 	for i in id_list:
                # 		write.writerow(i)
                try:
                    for i in id_list:
                        # write.writerow(i)
                        save(i)
                    db.commit()
                except Exception as e:
                    print("写入发生了异常:", e)
                    db.rollback()
                time.sleep(1)
            except Exception as e:
                print(e)
    return True
def save(res):
    name = res[0]
    category=res[1]
    poiid=res[2]
    ctpoi=res[3]
    areaname = res[4]
    city=res[5]
    sql = """
        insert into meituan(name,category,poiid,ctpoi,areaname,city) values('{}','{}','{}','{}','{}','{}')
    """.format(name,category,poiid,ctpoi,areaname,city)
    cursor.execute(sql)

if __name__ == '__main__':
    # 直接将html代码中区域的信息复制出来，南澳新区的数据需要处理下，它下面没有分区
    a = {
       "areaObj":{
    "32": [{
        "id": 5032,
        "name": "西塱",
        "latitude": 23065437,
        "longitude": 113231978,
        "count": 76
    }, {
        "id": 559,
        "name": "坑口",
        "latitude": 23078878,
        "longitude": 113232498,
        "count": 76
    }, {
        "id": 558,
        "name": "花地湾",
        "latitude": 23087055,
        "longitude": 113234030,
        "count": 149
    }, {
        "id": 557,
        "name": "芳村",
        "latitude": 23098592,
        "longitude": 113235703,
        "count": 174
    }, {
        "id": 556,
        "name": "黄沙",
        "latitude": 23110524,
        "longitude": 113239856,
        "count": 315
    }, {
        "id": 555,
        "name": "长寿路",
        "latitude": 23118402,
        "longitude": 113242271,
        "count": 459
    }, {
        "id": 554,
        "name": "陈家祠",
        "latitude": 23125727,
        "longitude": 113246439,
        "count": 476
    }, {
        "id": 553,
        "name": "西门口",
        "latitude": 23125219,
        "longitude": 113255830,
        "count": 427
    }, {
        "id": 552,
        "name": "公园前",
        "latitude": 23125446,
        "longitude": 113264315,
        "count": 624
    }, {
        "id": 551,
        "name": "农讲所",
        "latitude": 23126623,
        "longitude": 113275602,
        "count": 587
    }, {
        "id": 550,
        "name": "烈士陵园",
        "latitude": 23126704,
        "longitude": 113285663,
        "count": 344
    }, {
        "id": 549,
        "name": "东山口",
        "latitude": 23123980,
        "longitude": 113295373,
        "count": 133
    }, {
        "id": 548,
        "name": "杨箕",
        "latitude": 23128137,
        "longitude": 113308877,
        "count": 234
    }, {
        "id": 547,
        "name": "体育西路",
        "latitude": 23131138,
        "longitude": 113321503,
        "count": 886
    }, {
        "id": 546,
        "name": "体育中心",
        "latitude": 23134970,
        "longitude": 113328379,
        "count": 955
    }, {
        "id": 545,
        "name": "广州东站",
        "latitude": 23150294,
        "longitude": 113325407,
        "count": 252
    }],
    "33": [{
        "id": 561,
        "name": "嘉禾望岗",
        "latitude": 23237528,
        "longitude": 113291343,
        "count": 149
    }, {
        "id": 562,
        "name": "黄边",
        "latitude": 23221699,
        "longitude": 113287498,
        "count": 99
    }, {
        "id": 563,
        "name": "江夏",
        "latitude": 23211331,
        "longitude": 113283564,
        "count": 178
    }, {
        "id": 564,
        "name": "萧岗",
        "latitude": 23198580,
        "longitude": 113280697,
        "count": 46
    }, {
        "id": 565,
        "name": "白云文化广场",
        "latitude": 23189713,
        "longitude": 113275678,
        "count": 75
    }, {
        "id": 566,
        "name": "白云公园",
        "latitude": 23181620,
        "longitude": 113271011,
        "count": 172
    }, {
        "id": 567,
        "name": "飞翔公园",
        "latitude": 23168955,
        "longitude": 113263771,
        "count": 321
    }, {
        "id": 568,
        "name": "三元里",
        "latitude": 23159402,
        "longitude": 113256851,
        "count": 209
    }, {
        "id": 569,
        "name": "广州火车站",
        "latitude": 23148149,
        "longitude": 113256589,
        "count": 145
    }, {
        "id": 570,
        "name": "越秀公园",
        "latitude": 23140245,
        "longitude": 113261271,
        "count": 85
    }, {
        "id": 571,
        "name": "纪念堂",
        "latitude": 23132179,
        "longitude": 113263431,
        "count": 307
    }, {
        "id": 572,
        "name": "公园前",
        "latitude": 23125455,
        "longitude": 113264202,
        "count": 625
    }, {
        "id": 573,
        "name": "海珠广场",
        "latitude": 23114320,
        "longitude": 113265455,
        "count": 401
    }, {
        "id": 574,
        "name": "市二宫",
        "latitude": 23106183,
        "longitude": 113270223,
        "count": 272
    }, {
        "id": 575,
        "name": "江南西",
        "latitude": 23097066,
        "longitude": 113273990,
        "count": 550
    }, {
        "id": 576,
        "name": "昌岗",
        "latitude": 23090683,
        "longitude": 113276887,
        "count": 511
    }, {
        "id": 577,
        "name": "江泰路",
        "latitude": 23082213,
        "longitude": 113280556,
        "count": 207
    }, {
        "id": 578,
        "name": "东晓南",
        "latitude": 23071084,
        "longitude": 113294775,
        "count": 274
    }, {
        "id": 579,
        "name": "南洲",
        "latitude": 23063910,
        "longitude": 113297790,
        "count": 211
    }, {
        "id": 580,
        "name": "洛溪",
        "latitude": 23043170,
        "longitude": 113298746,
        "count": 146
    }, {
        "id": 581,
        "name": "南浦",
        "latitude": 23033568,
        "longitude": 113293527,
        "count": 81
    }, {
        "id": 582,
        "name": "会江",
        "latitude": 23013131,
        "longitude": 113286382,
        "count": 21
    }, {
        "id": 583,
        "name": "石壁",
        "latitude": 22994116,
        "longitude": 113277929,
        "count": 10
    }, {
        "id": 584,
        "name": "广州南站",
        "latitude": 22989136,
        "longitude": 113269253,
        "count": 9
    }],
    "34": [{
        "id": 5048,
        "name": "机场北(2号航站楼)",
        "latitude": 23396197,
        "longitude": 113305659,
        "count": 1
    }, {
        "id": 5053,
        "name": "机场南(1号航站楼)",
        "latitude": 23386627,
        "longitude": 113303048,
        "count": 1
    }, {
        "id": 5049,
        "name": "高增",
        "latitude": 23355162,
        "longitude": 113295504,
        "count": 31
    }, {
        "id": 5044,
        "name": "人和",
        "latitude": 23335224,
        "longitude": 113295995,
        "count": 167
    }, {
        "id": 5061,
        "name": "龙归",
        "latitude": 23288736,
        "longitude": 113300834,
        "count": 30
    }, {
        "id": 5051,
        "name": "嘉禾望岗",
        "latitude": 23237460,
        "longitude": 113289243,
        "count": 195
    }, {
        "id": 5052,
        "name": "白云大道北",
        "latitude": 23222382,
        "longitude": 113298178,
        "count": 338
    }, {
        "id": 5033,
        "name": "永泰",
        "latitude": 23220226,
        "longitude": 113306295,
        "count": 249
    }, {
        "id": 5040,
        "name": "同和",
        "latitude": 23197060,
        "longitude": 113326264,
        "count": 202
    }, {
        "id": 5058,
        "name": "京溪南方医院",
        "latitude": 23185225,
        "longitude": 113326126,
        "count": 323
    }, {
        "id": 5043,
        "name": "梅花园",
        "latitude": 23175211,
        "longitude": 113320507,
        "count": 176
    }, {
        "id": 5036,
        "name": "燕塘",
        "latitude": 23159980,
        "longitude": 113327132,
        "count": 125
    }, {
        "id": 5034,
        "name": "广州东站",
        "latitude": 23150968,
        "longitude": 113324851,
        "count": 230
    }, {
        "id": 5050,
        "name": "林和西",
        "latitude": 23141525,
        "longitude": 113323947,
        "count": 474
    }, {
        "id": 5046,
        "name": "体育西路",
        "latitude": 23131138,
        "longitude": 113321503,
        "count": 881
    }, {
        "id": 5060,
        "name": "天河客运站",
        "latitude": 23170673,
        "longitude": 113343702,
        "count": 192
    }, {
        "id": 5055,
        "name": "五山",
        "latitude": 23152833,
        "longitude": 113351812,
        "count": 38
    }, {
        "id": 5059,
        "name": "华师",
        "latitude": 23140290,
        "longitude": 113345330,
        "count": 300
    }, {
        "id": 5045,
        "name": "岗顶",
        "latitude": 23134880,
        "longitude": 113339601,
        "count": 595
    }, {
        "id": 5062,
        "name": "石牌桥",
        "latitude": 23133135,
        "longitude": 113332124,
        "count": 867
    }, {
        "id": 5038,
        "name": "珠江新城",
        "latitude": 23119293,
        "longitude": 113321206,
        "count": 637
    }, {
        "id": 5047,
        "name": "广州塔",
        "latitude": 23106375,
        "longitude": 113323618,
        "count": 57
    }, {
        "id": 5039,
        "name": "客村",
        "latitude": 23096197,
        "longitude": 113320331,
        "count": 304
    }, {
        "id": 5056,
        "name": "大塘",
        "latitude": 23077974,
        "longitude": 113321677,
        "count": 62
    }, {
        "id": 5054,
        "name": "沥滘",
        "latitude": 23054898,
        "longitude": 113319077,
        "count": 29
    }, {
        "id": 5035,
        "name": "厦滘",
        "latitude": 23038007,
        "longitude": 113320837,
        "count": 109
    }, {
        "id": 5057,
        "name": "大石",
        "latitude": 23017761,
        "longitude": 113321744,
        "count": 262
    }, {
        "id": 5037,
        "name": "汉溪长隆",
        "latitude": 22992931,
        "longitude": 113330170,
        "count": 92
    }, {
        "id": 5041,
        "name": "市桥",
        "latitude": 22949743,
        "longitude": 113361726,
        "count": 332
    }, {
        "id": 5042,
        "name": "番禺广场",
        "latitude": 22935482,
        "longitude": 113385642,
        "count": 154
    }],
    "35": [{
        "id": 601,
        "name": "机场南",
        "latitude": 23386560,
        "longitude": 113303034,
        "count": 1
    }, {
        "id": 602,
        "name": "人和",
        "latitude": 23335328,
        "longitude": 113295911,
        "count": 168
    }, {
        "id": 603,
        "name": "龙归",
        "latitude": 23285245,
        "longitude": 113303275,
        "count": 31
    }, {
        "id": 604,
        "name": "嘉禾望岗",
        "latitude": 23239005,
        "longitude": 113291198,
        "count": 145
    }, {
        "id": 605,
        "name": "白云大道北",
        "latitude": 23222900,
        "longitude": 113298299,
        "count": 339
    }, {
        "id": 606,
        "name": "永泰",
        "latitude": 23220528,
        "longitude": 113305088,
        "count": 292
    }, {
        "id": 607,
        "name": "同和",
        "latitude": 23196826,
        "longitude": 113325941,
        "count": 210
    }, {
        "id": 608,
        "name": "京溪南方医院",
        "latitude": 23185333,
        "longitude": 113326234,
        "count": 325
    }, {
        "id": 1004,
        "name": "梅花园",
        "latitude": 23175254,
        "longitude": 113320293,
        "count": 177
    }, {
        "id": 609,
        "name": "燕塘",
        "latitude": 23159980,
        "longitude": 113327132,
        "count": 125
    }, {
        "id": 610,
        "name": "广州东站",
        "latitude": 23149621,
        "longitude": 113324887,
        "count": 249
    }, {
        "id": 611,
        "name": "林和西",
        "latitude": 23141812,
        "longitude": 113323800,
        "count": 469
    }, {
        "id": 612,
        "name": "体育西路",
        "latitude": 23131117,
        "longitude": 113321465,
        "count": 885
    }],
    "36": [{
        "id": 5066,
        "name": "南沙客运港",
        "latitude": 22766988,
        "longitude": 113610968,
        "count": 3
    }, {
        "id": 5063,
        "name": "南横",
        "latitude": 22747885,
        "longitude": 113594381,
        "count": 5
    }, {
        "id": 5065,
        "name": "塘坑",
        "latitude": 22753098,
        "longitude": 113573064,
        "count": 15
    }, {
        "id": 5069,
        "name": "大涌",
        "latitude": 22759076,
        "longitude": 113555975,
        "count": 6
    }, {
        "id": 5064,
        "name": "广隆",
        "latitude": 22772143,
        "longitude": 113540728,
        "count": 1
    }, {
        "id": 5068,
        "name": "飞沙角",
        "latitude": 22781854,
        "longitude": 113540758,
        "count": 6
    }, {
        "id": 613,
        "name": "金洲",
        "latitude": 22792271,
        "longitude": 113538896,
        "count": 115
    }, {
        "id": 614,
        "name": "蕉门",
        "latitude": 22800551,
        "longitude": 113527683,
        "count": 86
    }, {
        "id": 615,
        "name": "黄阁",
        "latitude": 22824855,
        "longitude": 113518970,
        "count": 8
    }, {
        "id": 616,
        "name": "黄阁汽车城",
        "latitude": 22835701,
        "longitude": 113509796,
        "count": 3
    }, {
        "id": 5067,
        "name": "庆盛",
        "latitude": 22866999,
        "longitude": 113490456,
        "count": 2
    }, {
        "id": 617,
        "name": "东涌",
        "latitude": 22885599,
        "longitude": 113478881,
        "count": 1
    }, {
        "id": 618,
        "name": "低涌",
        "latitude": 22919371,
        "longitude": 113484957,
        "count": 0
    }, {
        "id": 619,
        "name": "海傍",
        "latitude": 22939579,
        "longitude": 113475355,
        "count": 35
    }, {
        "id": 620,
        "name": "石碁",
        "latitude": 22957293,
        "longitude": 113465170,
        "count": 31
    }, {
        "id": 621,
        "name": "新造",
        "latitude": 23028281,
        "longitude": 113415636,
        "count": 7
    }, {
        "id": 622,
        "name": "大学城南",
        "latitude": 23043420,
        "longitude": 113400431,
        "count": 11
    }, {
        "id": 623,
        "name": "大学城北",
        "latitude": 23058098,
        "longitude": 113385625,
        "count": 119
    }, {
        "id": 624,
        "name": "官洲",
        "latitude": 23066948,
        "longitude": 113376890,
        "count": 3
    }, {
        "id": 625,
        "name": "万胜围",
        "latitude": 23097712,
        "longitude": 113384796,
        "count": 124
    }, {
        "id": 626,
        "name": "车陂南",
        "latitude": 23115928,
        "longitude": 113389568,
        "count": 113
    }, {
        "id": 627,
        "name": "车陂",
        "latitude": 23124467,
        "longitude": 113395539,
        "count": 394
    }, {
        "id": 628,
        "name": "黄村",
        "latitude": 23131797,
        "longitude": 113407143,
        "count": 113
    }],
    "37": [{
        "id": 629,
        "name": "文冲",
        "latitude": 23103622,
        "longitude": 113468940,
        "count": 66
    }, {
        "id": 630,
        "name": "大沙东",
        "latitude": 23106220,
        "longitude": 113458497,
        "count": 116
    }, {
        "id": 631,
        "name": "大沙地",
        "latitude": 23103489,
        "longitude": 113446627,
        "count": 168
    }, {
        "id": 632,
        "name": "鱼珠",
        "latitude": 23100419,
        "longitude": 113432295,
        "count": 8
    }, {
        "id": 633,
        "name": "三溪",
        "latitude": 23103860,
        "longitude": 113415390,
        "count": 39
    }, {
        "id": 634,
        "name": "东圃",
        "latitude": 23109392,
        "longitude": 113401574,
        "count": 105
    }, {
        "id": 635,
        "name": "车陂南",
        "latitude": 23115969,
        "longitude": 113389313,
        "count": 109
    }, {
        "id": 636,
        "name": "科韵路",
        "latitude": 23119184,
        "longitude": 113376862,
        "count": 222
    }, {
        "id": 637,
        "name": "员村",
        "latitude": 23115774,
        "longitude": 113363701,
        "count": 257
    }, {
        "id": 638,
        "name": "潭村",
        "latitude": 23117391,
        "longitude": 113345696,
        "count": 138
    }, {
        "id": 639,
        "name": "猎德",
        "latitude": 23118492,
        "longitude": 113332730,
        "count": 406
    }, {
        "id": 640,
        "name": "珠江新城",
        "latitude": 23119406,
        "longitude": 113321231,
        "count": 641
    }, {
        "id": 641,
        "name": "五羊邨",
        "latitude": 23119948,
        "longitude": 113314712,
        "count": 437
    }, {
        "id": 642,
        "name": "杨箕",
        "latitude": 23127199,
        "longitude": 113307796,
        "count": 227
    }, {
        "id": 643,
        "name": "动物园",
        "latitude": 23134504,
        "longitude": 113307300,
        "count": 130
    }, {
        "id": 644,
        "name": "区庄",
        "latitude": 23134452,
        "longitude": 113296637,
        "count": 177
    }, {
        "id": 645,
        "name": "淘金",
        "latitude": 23136362,
        "longitude": 113286568,
        "count": 298
    }, {
        "id": 646,
        "name": "小北",
        "latitude": 23139451,
        "longitude": 113276178,
        "count": 156
    }, {
        "id": 647,
        "name": "广州火车站",
        "latitude": 23148149,
        "longitude": 113256589,
        "count": 145
    }, {
        "id": 648,
        "name": "西村",
        "latitude": 23141848,
        "longitude": 113241759,
        "count": 130
    }, {
        "id": 649,
        "name": "西场",
        "latitude": 23137287,
        "longitude": 113238033,
        "count": 154
    }, {
        "id": 650,
        "name": "中山八",
        "latitude": 23126013,
        "longitude": 113232819,
        "count": 155
    }, {
        "id": 651,
        "name": "坦尾",
        "latitude": 23125530,
        "longitude": 113217718,
        "count": 30
    }, {
        "id": 652,
        "name": "滘口",
        "latitude": 23113708,
        "longitude": 113208560,
        "count": 29
    }],
    "38": [{
        "id": 653,
        "name": "万胜围",
        "latitude": 23097712,
        "longitude": 113384796,
        "count": 124
    }, {
        "id": 654,
        "name": "琶洲",
        "latitude": 23098519,
        "longitude": 113366700,
        "count": 48
    }, {
        "id": 655,
        "name": "新港东",
        "latitude": 23098705,
        "longitude": 113358252,
        "count": 30
    }, {
        "id": 656,
        "name": "磨碟沙",
        "latitude": 23098667,
        "longitude": 113342582,
        "count": 31
    }, {
        "id": 657,
        "name": "赤岗",
        "latitude": 23096432,
        "longitude": 113334825,
        "count": 121
    }, {
        "id": 658,
        "name": "客村",
        "latitude": 23096195,
        "longitude": 113320236,
        "count": 308
    }, {
        "id": 659,
        "name": "鹭江",
        "latitude": 23095350,
        "longitude": 113308419,
        "count": 204
    }, {
        "id": 660,
        "name": "中大",
        "latitude": 23092124,
        "longitude": 113292871,
        "count": 129
    }, {
        "id": 661,
        "name": "晓港",
        "latitude": 23093254,
        "longitude": 113282360,
        "count": 272
    }, {
        "id": 662,
        "name": "昌岗",
        "latitude": 23090683,
        "longitude": 113276887,
        "count": 511
    }, {
        "id": 663,
        "name": "宝岗大道",
        "latitude": 23086005,
        "longitude": 113269376,
        "count": 321
    }, {
        "id": 1005,
        "name": "沙园",
        "latitude": 23088818,
        "longitude": 113260450,
        "count": 260
    }, {
        "id": 664,
        "name": "凤凰新村",
        "latitude": 23094856,
        "longitude": 113255919,
        "count": 237
    }],
    "39": [{
        "id": 665,
        "name": "林和西",
        "latitude": 23141525,
        "longitude": 113323947,
        "count": 477
    }, {
        "id": 666,
        "name": "体育中心南",
        "latitude": 23134363,
        "longitude": 113324303,
        "count": 973
    }, {
        "id": 667,
        "name": "天河南",
        "latitude": 23131198,
        "longitude": 113324491,
        "count": 937
    }, {
        "id": 668,
        "name": "黄埔大道",
        "latitude": 23126998,
        "longitude": 113324491,
        "count": 1110
    }, {
        "id": 669,
        "name": "妇儿中心",
        "latitude": 23122725,
        "longitude": 113324569,
        "count": 856
    }, {
        "id": 670,
        "name": "花城大道",
        "latitude": 23118879,
        "longitude": 113324499,
        "count": 608
    }, {
        "id": 671,
        "name": "大剧院",
        "latitude": 23115928,
        "longitude": 113324463,
        "count": 483
    }, {
        "id": 672,
        "name": "海心沙",
        "latitude": 23111459,
        "longitude": 113324103,
        "count": 272
    }, {
        "id": 673,
        "name": "广州塔",
        "latitude": 23105979,
        "longitude": 113323671,
        "count": 59
    }],
    "40": [{
        "id": 5127,
        "name": "沥滘",
        "latitude": 23054792,
        "longitude": 113318553,
        "count": 29
    }, {
        "id": 5132,
        "name": "南洲",
        "latitude": 23064799,
        "longitude": 113297367,
        "count": 236
    }, {
        "id": 5117,
        "name": "石溪",
        "latitude": 23067937,
        "longitude": 113285951,
        "count": 195
    }, {
        "id": 5134,
        "name": "燕岗",
        "latitude": 23075142,
        "longitude": 113271988,
        "count": 116
    }, {
        "id": 5115,
        "name": "沙园",
        "latitude": 23088614,
        "longitude": 113260586,
        "count": 256
    }, {
        "id": 5124,
        "name": "沙涌",
        "latitude": 23083043,
        "longitude": 113246794,
        "count": 37
    }, {
        "id": 5130,
        "name": "鹤洞",
        "latitude": 23072495,
        "longitude": 113240153,
        "count": 81
    }, {
        "id": 5138,
        "name": "西塱",
        "latitude": 23065437,
        "longitude": 113231978,
        "count": 76
    }, {
        "id": 5126,
        "name": "菊树",
        "latitude": 23065868,
        "longitude": 113212863,
        "count": 5
    }, {
        "id": 5137,
        "name": "龙溪",
        "latitude": 23066029,
        "longitude": 113192391,
        "count": 22
    }, {
        "id": 5119,
        "name": "金融高新区",
        "latitude": 23065814,
        "longitude": 113158548,
        "count": 0
    }, {
        "id": 5125,
        "name": "千灯湖",
        "latitude": 23054818,
        "longitude": 113155356,
        "count": 0
    }, {
        "id": 5131,
        "name": "礌岗",
        "latitude": 23042607,
        "longitude": 113155426,
        "count": 0
    }, {
        "id": 5120,
        "name": "南桂路",
        "latitude": 23034167,
        "longitude": 113154139,
        "count": 0
    }, {
        "id": 5123,
        "name": "桂城",
        "latitude": 23031674,
        "longitude": 113141432,
        "count": 0
    }, {
        "id": 5118,
        "name": "朝安",
        "latitude": 23027676,
        "longitude": 113133537,
        "count": 0
    }, {
        "id": 5133,
        "name": "普君北路",
        "latitude": 23027678,
        "longitude": 113122240,
        "count": 0
    }, {
        "id": 5136,
        "name": "祖庙",
        "latitude": 23027073,
        "longitude": 113112099,
        "count": 0
    }, {
        "id": 5128,
        "name": "同济路",
        "latitude": 23019222,
        "longitude": 113108503,
        "count": 0
    }, {
        "id": 5122,
        "name": "季华园",
        "latitude": 23007104,
        "longitude": 113108547,
        "count": 0
    }, {
        "id": 5121,
        "name": "魁奇路",
        "latitude": 22993964,
        "longitude": 113108612,
        "count": 0
    }, {
        "id": 5116,
        "name": "澜石",
        "latitude": 22983985,
        "longitude": 113107107,
        "count": 0
    }, {
        "id": 5135,
        "name": "世纪莲",
        "latitude": 22965147,
        "longitude": 113114917,
        "count": 0
    }, {
        "id": 5129,
        "name": "东平",
        "latitude": 22965266,
        "longitude": 113129190,
        "count": 0
    }, {
        "id": 5114,
        "name": "新城东",
        "latitude": 22958653,
        "longitude": 113140008,
        "count": 0
    }],
    "78": [{
        "id": 1553,
        "name": "浔峰岗",
        "latitude": 23164334,
        "longitude": 113201640,
        "count": 66
    }, {
        "id": 1534,
        "name": "横沙",
        "latitude": 23157847,
        "longitude": 113206642,
        "count": 171
    }, {
        "id": 1535,
        "name": "沙贝",
        "latitude": 23152108,
        "longitude": 113211573,
        "count": 174
    }, {
        "id": 1536,
        "name": "河沙",
        "latitude": 23135541,
        "longitude": 113217764,
        "count": 57
    }, {
        "id": 1545,
        "name": "坦尾",
        "latitude": 23125453,
        "longitude": 113218289,
        "count": 31
    }, {
        "id": 1550,
        "name": "如意坊",
        "latitude": 23114938,
        "longitude": 113231084,
        "count": 81
    }, {
        "id": 1541,
        "name": "黄沙",
        "latitude": 23110052,
        "longitude": 113240664,
        "count": 323
    }, {
        "id": 1542,
        "name": "文化公园",
        "latitude": 23109184,
        "longitude": 113248945,
        "count": 288
    }, {
        "id": 1544,
        "name": "一德路",
        "latitude": 23113027,
        "longitude": 113257164,
        "count": 225
    }, {
        "id": 1543,
        "name": "海珠广场",
        "latitude": 23115016,
        "longitude": 113265831,
        "count": 447
    }, {
        "id": 1551,
        "name": "北京路",
        "latitude": 23118723,
        "longitude": 113270252,
        "count": 633
    }, {
        "id": 1546,
        "name": "团一大广场",
        "latitude": 23118111,
        "longitude": 113278266,
        "count": 421
    }, {
        "id": 1539,
        "name": "东湖",
        "latitude": 23115126,
        "longitude": 113288500,
        "count": 134
    }, {
        "id": 1540,
        "name": "东山口",
        "latitude": 23123984,
        "longitude": 113295376,
        "count": 133
    }, {
        "id": 1548,
        "name": "区庄",
        "latitude": 23133791,
        "longitude": 113297119,
        "count": 181
    }, {
        "id": 1552,
        "name": "黄花岗",
        "latitude": 23141170,
        "longitude": 113299951,
        "count": 73
    }, {
        "id": 1538,
        "name": "沙河顶",
        "latitude": 23147149,
        "longitude": 113307000,
        "count": 43
    }, {
        "id": 1533,
        "name": "天平架",
        "latitude": 23159522,
        "longitude": 113321309,
        "count": 107
    }, {
        "id": 1549,
        "name": "燕塘",
        "latitude": 23159980,
        "longitude": 113327132,
        "count": 125
    }, {
        "id": 1532,
        "name": "天河客运站",
        "latitude": 23170969,
        "longitude": 113343587,
        "count": 189
    }, {
        "id": 1547,
        "name": "长湴",
        "latitude": 23178593,
        "longitude": 113349572,
        "count": 110
    }, {
        "id": 4304,
        "name": "植物园",
        "latitude": 23190164,
        "longitude": 113365686,
        "count": 248
    }, {
        "id": 4308,
        "name": "龙洞",
        "latitude": 23190960,
        "longitude": 113377520,
        "count": 10
    }, {
        "id": 4309,
        "name": "柯木塱",
        "latitude": 23193462,
        "longitude": 113395991,
        "count": 28
    }, {
        "id": 4302,
        "name": "高塘石",
        "latitude": 23191057,
        "longitude": 113410408,
        "count": 5
    }, {
        "id": 4307,
        "name": "黄陂",
        "latitude": 23188379,
        "longitude": 113433738,
        "count": 9
    }, {
        "id": 4301,
        "name": "金峰",
        "latitude": 23181468,
        "longitude": 113451182,
        "count": 37
    }, {
        "id": 4300,
        "name": "暹岗",
        "latitude": 23172359,
        "longitude": 113460224,
        "count": 158
    }, {
        "id": 4305,
        "name": "苏元",
        "latitude": 23170935,
        "longitude": 113468534,
        "count": 134
    }, {
        "id": 4303,
        "name": "萝岗",
        "latitude": 23175684,
        "longitude": 113481032,
        "count": 11
    }, {
        "id": 4306,
        "name": "香雪",
        "latitude": 23172409,
        "longitude": 113501197,
        "count": 131
    }],
    "164": [{
        "id": 4467,
        "name": "广州南站",
        "latitude": 22988980,
        "longitude": 113269125,
        "count": 9
    }, {
        "id": 4470,
        "name": "石壁",
        "latitude": 22994136,
        "longitude": 113277964,
        "count": 10
    }, {
        "id": 4468,
        "name": "谢村",
        "latitude": 22990579,
        "longitude": 113295832,
        "count": 0
    }, {
        "id": 4466,
        "name": "钟村",
        "latitude": 22986437,
        "longitude": 113316980,
        "count": 51
    }, {
        "id": 4464,
        "name": "汉溪长隆",
        "latitude": 22994220,
        "longitude": 113330173,
        "count": 94
    }, {
        "id": 4463,
        "name": "南村万博",
        "latitude": 23004769,
        "longitude": 113347555,
        "count": 218
    }, {
        "id": 4471,
        "name": "员岗",
        "latitude": 23015962,
        "longitude": 113365641,
        "count": 62
    }, {
        "id": 4469,
        "name": "板桥",
        "latitude": 23016845,
        "longitude": 113388139,
        "count": 38
    }, {
        "id": 4465,
        "name": "大学城南",
        "latitude": 23043313,
        "longitude": 113400557,
        "count": 11
    }],
    "187": [{
        "id": 4969,
        "name": "镇龙西",
        "latitude": 23278088,
        "longitude": 113573793,
        "count": 1
    }, {
        "id": 4967,
        "name": "镇龙",
        "latitude": 23284514,
        "longitude": 113593000,
        "count": 0
    }, {
        "id": 4968,
        "name": "中新",
        "latitude": 23285303,
        "longitude": 113613131,
        "count": 25
    }, {
        "id": 4963,
        "name": "坑贝",
        "latitude": 23278769,
        "longitude": 113642606,
        "count": 0
    }, {
        "id": 4962,
        "name": "凤岗",
        "latitude": 23275961,
        "longitude": 113670634,
        "count": 0
    }, {
        "id": 4966,
        "name": "朱村",
        "latitude": 23272316,
        "longitude": 113701415,
        "count": 5
    }, {
        "id": 4964,
        "name": "山田",
        "latitude": 23276428,
        "longitude": 113744543,
        "count": 1
    }, {
        "id": 4970,
        "name": "钟岗",
        "latitude": 23279317,
        "longitude": 113792047,
        "count": 1
    }, {
        "id": 4965,
        "name": "增城广场",
        "latitude": 23278024,
        "longitude": 113814472,
        "count": 165
    }],
    "191": [{
        "id": 5079,
        "name": "高增",
        "latitude": 23355162,
        "longitude": 113295504,
        "count": 31
    }, {
        "id": 5080,
        "name": "清塘",
        "latitude": 23372206,
        "longitude": 113262858,
        "count": 44
    }, {
        "id": 5071,
        "name": "清布",
        "latitude": 23378122,
        "longitude": 113250989,
        "count": 39
    }, {
        "id": 5076,
        "name": "莲塘",
        "latitude": 23389101,
        "longitude": 113245149,
        "count": 46
    }, {
        "id": 5070,
        "name": "马鞍山公园",
        "latitude": 23399699,
        "longitude": 113237846,
        "count": 208
    }, {
        "id": 5073,
        "name": "花都广场",
        "latitude": 23401307,
        "longitude": 113222628,
        "count": 281
    }, {
        "id": 5075,
        "name": "花果山公园",
        "latitude": 23387119,
        "longitude": 113218389,
        "count": 215
    }, {
        "id": 5078,
        "name": "花城路",
        "latitude": 23379622,
        "longitude": 113212740,
        "count": 238
    }, {
        "id": 5072,
        "name": "广州北站",
        "latitude": 23376419,
        "longitude": 113201568,
        "count": 134
    }, {
        "id": 5077,
        "name": "花都汽车城",
        "latitude": 23379671,
        "longitude": 113180367,
        "count": 8
    }, {
        "id": 5074,
        "name": "飞鹅岭",
        "latitude": 23378345,
        "longitude": 113155127,
        "count": 13
    }],
    "192": [{
        "id": 5081,
        "name": "新沙",
        "latitude": 23136863,
        "longitude": 113649417,
        "count": 1
    }, {
        "id": 5086,
        "name": "官湖",
        "latitude": 23137226,
        "longitude": 113636569,
        "count": 2
    }, {
        "id": 5088,
        "name": "新塘",
        "latitude": 23131731,
        "longitude": 113604472,
        "count": 94
    }, {
        "id": 5091,
        "name": "白江",
        "latitude": 23123235,
        "longitude": 113595627,
        "count": 69
    }, {
        "id": 5090,
        "name": "沙村",
        "latitude": 23110590,
        "longitude": 113570399,
        "count": 12
    }, {
        "id": 5089,
        "name": "南岗",
        "latitude": 23095280,
        "longitude": 113541486,
        "count": 26
    }, {
        "id": 5084,
        "name": "夏园",
        "latitude": 23082901,
        "longitude": 113518376,
        "count": 62
    }, {
        "id": 5082,
        "name": "南海神庙",
        "latitude": 23083718,
        "longitude": 113497434,
        "count": 2
    }, {
        "id": 5083,
        "name": "双岗",
        "latitude": 23094468,
        "longitude": 113474331,
        "count": 49
    }, {
        "id": 5085,
        "name": "裕丰围",
        "latitude": 23094934,
        "longitude": 113455011,
        "count": 70
    }, {
        "id": 5087,
        "name": "鱼珠",
        "latitude": 23100431,
        "longitude": 113432261,
        "count": 7
    }],
    "193": [{
        "id": 5103,
        "name": "东风",
        "latitude": 23566233,
        "longitude": 113600801,
        "count": 1
    }, {
        "id": 5101,
        "name": "从化客运站",
        "latitude": 23531769,
        "longitude": 113594721,
        "count": 109
    }, {
        "id": 5093,
        "name": "赤草",
        "latitude": 23501199,
        "longitude": 113560204,
        "count": 1
    }, {
        "id": 5107,
        "name": "神岗",
        "latitude": 23475101,
        "longitude": 113517396,
        "count": 0
    }, {
        "id": 5106,
        "name": "太平",
        "latitude": 23452090,
        "longitude": 113491955,
        "count": 12
    }, {
        "id": 5094,
        "name": "新和",
        "latitude": 23413259,
        "longitude": 113467060,
        "count": 0
    }, {
        "id": 5092,
        "name": "马沥",
        "latitude": 23393877,
        "longitude": 113450388,
        "count": 0
    }, {
        "id": 5097,
        "name": "钟落潭",
        "latitude": 23375649,
        "longitude": 113400686,
        "count": 31
    }, {
        "id": 5111,
        "name": "竹料",
        "latitude": 23348496,
        "longitude": 113368332,
        "count": 10
    }, {
        "id": 5104,
        "name": "太和",
        "latitude": 23299284,
        "longitude": 113347197,
        "count": 26
    }, {
        "id": 5108,
        "name": "夏良",
        "latitude": 23277704,
        "longitude": 113323505,
        "count": 27
    }, {
        "id": 5112,
        "name": "白云东平",
        "latitude": 23251170,
        "longitude": 113317841,
        "count": 90
    }, {
        "id": 5105,
        "name": "嘉禾望岗",
        "latitude": 23237437,
        "longitude": 113288956,
        "count": 199
    }, {
        "id": 5099,
        "name": "镇龙",
        "latitude": 23284514,
        "longitude": 113593000,
        "count": 0
    }, {
        "id": 5109,
        "name": "镇龙北",
        "latitude": 23289584,
        "longitude": 113576945,
        "count": 0
    }, {
        "id": 5110,
        "name": "汤村",
        "latitude": 23307382,
        "longitude": 113564686,
        "count": 3
    }, {
        "id": 5095,
        "name": "旺村",
        "latitude": 23323256,
        "longitude": 113551749,
        "count": 1
    }, {
        "id": 5113,
        "name": "何棠下",
        "latitude": 23331190,
        "longitude": 113543688,
        "count": 2
    }, {
        "id": 5096,
        "name": "知识城",
        "latitude": 23349377,
        "longitude": 113525198,
        "count": 4
    }, {
        "id": 5102,
        "name": "枫下",
        "latitude": 23363059,
        "longitude": 113508322,
        "count": 0
    }, {
        "id": 5100,
        "name": "新南",
        "latitude": 23377232,
        "longitude": 113495228,
        "count": 0
    }, {
        "id": 5098,
        "name": "红卫",
        "latitude": 23399261,
        "longitude": 113487415,
        "count": 0
    }]
}

    }
    res = get_cookie()
    cookie = res[1]
    uuid = {i.split("=")[0]:i.split("=")[1] for i in cookie.split("; ")}["uuid"]
    ua = res[2]
    datas = a['areaObj']
    s=datas.keys()
    b = datas.values()
    area_list = []
    b=list(zip(s,b))
    for data in b:
        # print(data[1])
        for d in data[1]:
            d.update(lineid=data[0])
            area_list.append(d)  # 将每个区域信息保存到列表，元素是字典
    print(area_list)
    l = 0
    # print(len(area_list))
    old = time.time()
    for i in area_list[10:]:

        l += 1
        print('开始抓取第%d个区域：' % l, i['name'], '店铺总数：', i['count'])
        # if i['regionName'] == "回龙观":
        #     print(area_list.index(i))
        try:
            # pass
            aa=crow_id(i['id'],cookie,uuid,ua,i["lineid"])
            if aa:
                now = time.time() - old
                print(i['name'], '抓取完成！', '时间:%d' % now)
            else:
                res = get_cookie(1)
                cookie = res[1]
                uuid = {i.split("=")[0]: i.split("=")[1] for i in cookie.split("; ")}["uuid"]
                ua = res[2]
        except Exception as e:
            print(e)
